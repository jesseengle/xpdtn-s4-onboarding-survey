<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>XPDTN Season 4 AI Survey</title>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
        Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: #121212;
      color: #ffffff;
      padding: 2rem;
    }
    h1 {
      color: #00ffe0;
      text-align: center;
      margin-bottom: 3rem;
    }
    .chart-container {
      margin-bottom: 3rem;
    }
    .question {
      font-size: 1.2rem;
      margin-bottom: 1rem;
    }
    .bar {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .bar-label {
      width: 30%;
    }
    .bar-fill {
      height: 20px;
      border-radius: 10px;
      background: linear-gradient(90deg, #00ffe0, #0077ff);
      transition: width 1s ease-in-out;
    }
    .bar-value {
      margin-left: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>XPDTN Season 4 AI Survey</h1>
  <div id="dashboard"></div>

  <script>
    const endpoint = 'https://sheet2api.com/v1/eVtBQ3lcSgaF/xpdtn-s4-onboarding-survey-live';
    const COLUMNS = [
      'Which of the following best describes how you’re using AI in your work today? (select all that apply)',
      'What’s your go-to AI tool (if any) in your current workflow?',
      'How confident are you in using AI tools in your creator marketing work?',
      'Which areas of AI are you most curious to learn more about this season? (pick top 3)',
      'What’s your top priority for this season? (pick 1)',
      'Which areas of creator marketing would you be most interested in testing AI tools for?'
    ];

    async function loadSurveyData() {
      try {
        const res = await fetch(endpoint);
        const data = await res.json();

        const dashboard = document.getElementById('dashboard');

        COLUMNS.forEach(column => {
          const counts = {};
          data.forEach(row => {
            if (!row[column]) return;
            const answers = row[column].split(',').map(ans => ans.trim());
            answers.forEach(answer => {
              if (answer) counts[answer] = (counts[answer] || 0) + 1;
            });
          });

          const total = Object.values(counts).reduce((a, b) => a + b, 0);

          const container = document.createElement('div');
          container.className = 'chart-container';
          const question = document.createElement('div');
          question.className = 'question';
          question.textContent = column;
          container.appendChild(question);

          Object.entries(counts).sort((a, b) => b[1] - a[1]).forEach(([key, count]) => {
            const percent = ((count / total) * 100).toFixed(1);

            const bar = document.createElement('div');
            bar.className = 'bar';

            const label = document.createElement('div');
            label.className = 'bar-label';
            label.textContent = key;

            const fill = document.createElement('div');
            fill.className = 'bar-fill';
            fill.style.width = `${percent}%`;

            const value = document.createElement('div');
            value.className = 'bar-value';
            value.textContent = `${percent}%`;

            bar.appendChild(label);
            bar.appendChild(fill);
            bar.appendChild(value);

            container.appendChild(bar);
          });

          dashboard.appendChild(container);
        });
      } catch (err) {
        document.getElementById('dashboard').innerText = 'Error loading data';
        console.error(err);
      }
    }

    loadSurveyData();
  </script>
</body>
</html>
