
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>XPDTN AI Survey Dashboard</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      background-color: #121212;
      color: #f5f5f5;
      margin: 0;
      padding: 2rem;
    }

    h1 {
      text-align: center;
      color: #00d1b2;
      margin-bottom: 2rem;
    }

    .question-block {
      margin-bottom: 3rem;
    }

    .question-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .bar-container {
      background-color: #333;
      border-radius: 6px;
      margin: 0.25rem 0;
      overflow: hidden;
    }

    .bar {
      background: linear-gradient(90deg, #00d1b2, #00b8a9);
      color: #fff;
      padding: 0.5rem 1rem;
      font-size: 0.95rem;
      white-space: nowrap;
      overflow: hidden;
      animation: growBar 1.5s ease-out forwards;
      transform: scaleX(0);
      transform-origin: left;
    }

    @keyframes growBar {
      to {
        transform: scaleX(1);
      }
    }
  </style>
</head>
<body>
  <h1>XPDTN Season 4 AI Survey</h1>
  <div id="dashboard"></div>

  <script>
    const endpoint = "https://sheet2api.com/v1/eVtBQ3lcSgaF/xpdtn-s4-onboarding-survey-live";

    const questions = {
      "Which of the following best describes how you’re using AI in your work today? (select all that apply)": "How you’re using AI today",
      "What’s your go-to AI tool (if any) in your current workflow?": "Go-to AI Tool",
      "How confident are you in using AI tools in your creator marketing work?": "Confidence using AI",
      "Which areas of AI are you most curious to learn more about this season? (pick top 3)": "Top 3 AI Topics",
      "What’s your top priority for this season? (pick 1)": "Top Priority",
      "Which areas of creator marketing would you be most interested in testing AI tools for?": "Where to Test AI",
    };

    async function loadSurveyData() {
      try {
        const res = await fetch(endpoint);
        const data = await res.json();
        const dashboard = document.getElementById("dashboard");

        Object.entries(questions).forEach(([key, title]) => {
          const answerCounts = {};

          data.forEach(row => {
            let answers = row[key];
            if (!answers) return;
            if (typeof answers === 'string') {
              answers = answers.split(/,|\n|\r/);
            }
            answers.forEach(ans => {
              const cleaned = ans.trim();
              if (cleaned) {
                answerCounts[cleaned] = (answerCounts[cleaned] || 0) + 1;
              }
            });
          });

          const sortedAnswers = Object.entries(answerCounts).sort((a, b) => b[1] - a[1]);
          const total = Object.values(answerCounts).reduce((a, b) => a + b, 0);

          const block = document.createElement("div");
          block.className = "question-block";
          const heading = document.createElement("div");
          heading.className = "question-title";
          heading.textContent = title;
          block.appendChild(heading);

          sortedAnswers.forEach(([answer, count]) => {
            const percent = ((count / total) * 100).toFixed(1);
            const barContainer = document.createElement("div");
            barContainer.className = "bar-container";

            const bar = document.createElement("div");
            bar.className = "bar";
            bar.style.width = percent + "%";
            bar.textContent = `${answer} (${count})`;

            barContainer.appendChild(bar);
            block.appendChild(barContainer);
          });

          dashboard.appendChild(block);
        });
      } catch (err) {
        document.getElementById("dashboard").innerText = "Error loading data";
        console.error(err);
      }
    }

    loadSurveyData();
  </script>
</body>
</html>
