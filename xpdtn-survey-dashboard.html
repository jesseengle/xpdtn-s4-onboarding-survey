<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 1rem;
      background: white;
      color: #333;
    }
    .question {
      margin-bottom: 2rem;
    }
    .question h2 {
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }
    .bar-container {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .bar {
      height: 24px;
      background-color: #e0e0e0;
      position: relative;
      border-radius: 4px;
    }
    .bar-fill {
      height: 100%;
      background-color: #8ab4f8;
      border-radius: 4px;
      transition: width 0.3s ease;
    }
    .bar-label {
      position: absolute;
      left: 8px;
      top: 3px;
      font-size: 0.9rem;
      font-weight: 500;
      color: #111;
    }
    .bar-value {
      position: absolute;
      right: 8px;
      top: 3px;
      font-size: 0.9rem;
      color: #333;
    }
    .other-responses {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #555;
    }
  </style>
</head>
<body>
  <div id="charts"></div>

  <script>
    const endpoint = 'https://sheet2api.com/v1/eVtBQ3lcSgaF/xpdtn-s4-onboarding-survey-live';

    async function fetchData() {
      const res = await fetch(endpoint);
      const rows = await res.json();
      return rows;
    }

    function countGroupedValues(data, key, groups = {}) {
      const counts = {};
      const other = [];

      for (const row of data) {
        let value = (row[key] || '').trim();
        if (!value) continue;

        let matched = false;
        for (const [label, aliases] of Object.entries(groups)) {
          if (aliases.some(a => value.toLowerCase().includes(a.toLowerCase()))) {
            counts[label] = (counts[label] || 0) + 1;
            matched = true;
            break;
          }
        }

        if (!matched) {
          counts[value] = (counts[value] || 0) + 1;
          if (!groups) other.push(value);
        }
      }

      return { counts, other };
    }

    function renderBars(title, counts, options = {}) {
      const container = document.getElementById('charts');
      const question = document.createElement('div');
      question.className = 'question';
      const total = Object.values(counts).reduce((a, b) => a + b, 0);

      const titleEl = document.createElement('h2');
      titleEl.textContent = title;
      question.appendChild(titleEl);

      const barContainer = document.createElement('div');
      barContainer.className = 'bar-container';

      const sorted = Object.entries(counts).sort((a, b) => {
        if (options.reverseOrder) return b[0] - a[0]; // numerical descending
        return b[1] - a[1]; // frequency descending
      });

      if (options.explicitOrder) {
        sorted.sort((a, b) => options.explicitOrder.indexOf(a[0]) - options.explicitOrder.indexOf(b[0]));
      }

      for (const [label, count] of sorted) {
        const bar = document.createElement('div');
        bar.className = 'bar';

        const fill = document.createElement('div');
        fill.className = 'bar-fill';
        fill.style.width = `${(count / total) * 100}%`;

        const labelEl = document.createElement('div');
        labelEl.className = 'bar-label';
        labelEl.textContent = label;

        const valueEl = document.createElement('div');
        valueEl.className = 'bar-value';
        valueEl.textContent = count;

        bar.appendChild(fill);
        bar.appendChild(labelEl);
        bar.appendChild(valueEl);
        barContainer.appendChild(bar);
      }

      question.appendChild(barContainer);
      container.appendChild(question);
    }

    function renderOthers(title, list) {
      if (list.length === 0) return;
      const lastQ = document.querySelector('.question:last-child');
      const other = document.createElement('div');
      other.className = 'other-responses';
      other.innerHTML = `<strong>Other responses:</strong> ${list.join(', ')}`;
      lastQ.appendChild(other);
    }

    async function renderSurvey() {
      const data = await fetchData();
      const sample = data[0];

      const keys = Object.keys(sample);
      const targetKeys = [7, 8, 9, 10, 11, 17].map(i => keys[i]);

      // Q1: Go-to AI Tool
      const { counts: toolCounts, other: toolOthers } = countGroupedValues(data, targetKeys[0], {
        "ChatGPT": ["chatgpt", "chat gpt"],
        "Claude": ["claude"],
        "Gemini": ["gemini"]
      });
      renderBars("What's your go-to AI tool?", toolCounts);
      renderOthers("Other responses", Object.keys(toolCounts).filter(t => !["ChatGPT", "Claude", "Gemini"].includes(t)));

      // Q2: Confidence rating (1–5, reverse order)
      const confidenceCounts = {};
      for (const row of data) {
        const val = row[targetKeys[1]];
        if (val) confidenceCounts[val] = (confidenceCounts[val] || 0) + 1;
      }
      renderBars("How confident are you in using AI in your workflow?", confidenceCounts, {
        explicitOrder: ['5', '4', '3', '2', '1']
      });

      // Q3: How would you describe your AI pilot?
      const pilotCounts = {};
      for (const row of data) {
        const val = row[targetKeys[2]];
        if (val) pilotCounts[val] = (pilotCounts[val] || 0) + 1;
      }
      renderBars("How would you describe your AI pilot?", pilotCounts);

      // Q6: What describes your brand’s POV on AI?
      const povCounts = {};
      for (const row of data) {
        const val = row[targetKeys[5]];
        if (val) povCounts[val] = (povCounts[val] || 0) + 1;
      }
      renderBars("What describes your brand’s POV on AI?", povCounts);
    }

    renderSurvey();
  </script>
</body>
</html>
