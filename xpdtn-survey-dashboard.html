<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>XPDTN Survey Dashboard</title>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: "Inter", sans-serif;
      padding: 20px;
      margin: 0;
    }

    .question {
      margin-bottom: 40px;
    }

    .bar {
      height: 30px;
      background: linear-gradient(to right, #5eead4, #2dd4bf);
      margin-bottom: 8px;
      border-radius: 5px;
      animation: grow 1s ease-out forwards;
      transform: scaleX(0);
      transform-origin: left;
    }

    .label {
      margin-bottom: 4px;
      font-size: 16px;
      color: #ccc;
    }

    @keyframes grow {
      to {
        transform: scaleX(1);
      }
    }
  </style>
</head>
<body>
  <div id="dashboard"></div>

  <script>
    const endpoint = 'https://sheet2api.com/v1/eVtBQ3lcSgaF/xpdtn-s4-onboarding-survey-live';
    const columnsToShow = [
      "Which of the following best describes how you’re using AI in your work today? (select all that apply)",
      "What’s your go-to AI tool (if any) in your current workflow?",
      "How confident are you in using AI tools in your creator marketing work?",
      "Which areas of AI are you most curious to learn more about this season? (pick top 3)",
      "What’s your top priority for this season? (pick 1)",
      "Which areas of creator marketing would you be most interested in testing AI tools for?"
    ];

    async function loadSurveyData() {
      try {
        const res = await fetch(endpoint);
        const data = await res.json();
        const dashboard = document.getElementById('dashboard');

        columnsToShow.forEach((column) => {
          const counts = {};
          data.forEach(row => {
            const value = row[column];
            if (!value || typeof value !== 'string') return;

            value.split(',').map(v => v.trim()).forEach(option => {
              if (!option) return;
              counts[option] = (counts[option] || 0) + 1;
            });
          });

          const total = Object.values(counts).reduce((a, b) => a + b, 0);
          const container = document.createElement('div');
          container.className = 'question';

          Object.entries(counts)
            .sort((a, b) => b[1] - a[1])
            .forEach(([label, count]) => {
              const pct = ((count / total) * 100).toFixed(1);

              const labelEl = document.createElement('div');
              labelEl.className = 'label';
              labelEl.innerText = `${label} (${count})`;

              const barEl = document.createElement('div');
              barEl.className = 'bar';
              barEl.style.width = `${pct}%`;

              container.appendChild(labelEl);
              container.appendChild(barEl);
            });

          dashboard.appendChild(container);
        });
      } catch (e) {
        document.getElementById('dashboard').innerText = 'Error loading data';
        console.error(e);
      }
    }

    loadSurveyData();
  </script>
</body>
</html>
