
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>XPDTN Survey Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background-color: #121212;
      color: #f0f0f0;
    }
    h1, h2 {
      color: #90caf9;
    }
    .chart-container {
      margin-bottom: 3rem;
      background: #1e1e1e;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.4);
    }
    canvas {
      background-color: #fff;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>XPDTN Season 4: Survey Dashboard</h1>
  <div id="charts"></div>

  <script>
    const apiUrl = "https://sheet2api.com/v1/eVtBQ3lcSgaF/xpdtn-s4-onboarding-survey-live";

    const chartQuestions = {
      "Which of the following best describes how you’re using AI in your work today? (select all that apply)": "AI Usage Today",
      "What’s your go-to AI tool (if any) in your current workflow?": "Go-To AI Tool",
      "How confident are you in using AI tools in your creator marketing work?": "Confidence Level",
      "Which areas of AI are you most curious to learn more about this season? (pick top 3)": "AI Areas of Interest",
      "What’s your top priority for this season? (pick 1)": "Top Priority This Season",
      "Which areas of creator marketing would you be most interested in testing AI tools for?": "AI Test Areas in Creator Marketing"
    };

    async function loadSurveyData() {
      try {
        const res = await fetch(apiUrl);
        const data = await res.json();
        parseSurveyData(data);
      } catch (e) {
        document.body.innerHTML = "<h2>Error loading data</h2><pre>" + e + "</pre>";
      }
    }

    function parseSurveyData(data) {
      const responseCount = data.length;
      const questionStats = {};

      for (const row of data) {
        for (const col in chartQuestions) {
          const readableTitle = chartQuestions[col];
          const answer = row[col];

          if (!questionStats[readableTitle]) {
            questionStats[readableTitle] = {};
          }

          if (Array.isArray(answer)) {
            answer.forEach(a => {
              const trimmed = typeof a === 'string' ? a.trim() : '';
              if (trimmed) questionStats[readableTitle][trimmed] = (questionStats[readableTitle][trimmed] || 0) + 1;
            });
          } else if (typeof answer === 'string') {
            answer.split(",").forEach(a => {
              const trimmed = a.trim();
              if (trimmed) questionStats[readableTitle][trimmed] = (questionStats[readableTitle][trimmed] || 0) + 1;
            });
          }
        }
      }

      renderCharts(questionStats, responseCount);
    }

    function renderCharts(stats, totalResponses) {
      const chartsContainer = document.getElementById("charts");
      for (const [title, answers] of Object.entries(stats)) {
        const container = document.createElement("div");
        container.className = "chart-container";
        container.innerHTML = `<h2>${title}</h2><canvas id="${title.replace(/\s+/g, "-")}-chart"></canvas>`;
        chartsContainer.appendChild(container);

        const ctx = container.querySelector("canvas").getContext("2d");
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: Object.keys(answers),
            datasets: [{
              label: `Responses (${totalResponses})`,
              data: Object.values(answers),
              backgroundColor: "#90caf9"
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
              tooltip: { mode: "index", intersect: false }
            },
            scales: {
              x: { ticks: { color: "#f0f0f0" } },
              y: {
                beginAtZero: true,
                ticks: { stepSize: 1, color: "#f0f0f0" }
              }
            }
          }
        });
      }
    }

    loadSurveyData();
  </script>
</body>
</html>
