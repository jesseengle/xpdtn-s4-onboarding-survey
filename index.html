<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XPDTN Season 4 Survey Results - Live Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #ffffff;
            background: #1a1a1a;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #9ca3af;
            font-size: 1.1em;
        }
        
        .error {
            background: #3d1a1a;
            color: #ff6b6b;
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            border: 1px solid #5a2a2a;
        }
        
        .container {
            max-width: 100%;
            margin: 0;
            background: #1a1a1a;
        }
        
        .content {
            padding: 5px 15px 15px 15px;
            background: #1a1a1a;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        .survey-question {
            background: #2a2a2a;
            border-radius: 10px;
            padding: 18px;
            border: 1px solid #3a3a3a;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .section-title {
            font-size: 1.3em;
            margin-bottom: 8px;
            color: #ffffff;
            font-weight: 600;
            line-height: 1.3;
        }
        
        .response-count {
            color: #9ca3af;
            font-size: 0.9em;
            margin-bottom: 15px;
        }
        
        .responses-container {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 0 0 4px 0;
            border: 1px solid #3a3a3a;
        }
        
        .response-item {
            display: flex;
            align-items: center;
            padding: 16px 18px;
            margin-bottom: 4px;
            border-radius: 6px;
            position: relative;
            background: #1a1a1a;
            animation: fadeInBar 0.8s ease-out;
        }
        
        @keyframes fadeInBar {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .response-item:last-child {
            margin-bottom: 0;
        }
        
        .response-content {
            flex: 1;
            margin-right: 15px;
            z-index: 2;
            position: relative;
        }
        
        .response-text {
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 0;
            font-size: 1.1em;
            line-height: 1.3;
        }
        
        .response-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            border-radius: 6px;
        }
        
        .response-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #625166, #4a3d52);
            transition: width 1.2s ease-in-out;
            opacity: 0.8;
            border-radius: 6px;
            width: 0%;
        }
        
        .response-stats {
            text-align: right;
            flex-shrink: 0;
            min-width: 75px;
            z-index: 2;
            position: relative;
        }
        
        .response-percentage {
            color: #625166;
            font-weight: 700;
            font-size: 1.2em;
        }
        
        .response-number {
            color: #9ca3af;
            font-size: 0.85em;
            margin-top: 1px;
        }
        
        .other-responses {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #3a3a3a;
            margin-top: 12px;
        }
        
        .other-title {
            color: #625166;
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 1em;
        }
        
        .other-text {
            color: #d1d5db;
            line-height: 1.5;
            font-size: 0.9em;
        }
        
        .update-time {
            text-align: center;
            color: #6b7280;
            font-size: 0.75em;
            margin-top: 15px;
            margin-bottom: 20px;
            padding: 8px;
        }
        
        /* Mobile optimizations */
        @media (max-width: 480px) {
            .content {
                padding: 3px 12px 12px 12px;
            }
            
            .section-title {
                font-size: 1.2em;
            }
            
            .response-text {
                font-size: 1em;
            }
            
            .response-percentage {
                font-size: 1.1em;
            }
            
            .response-item {
                padding: 14px 16px;
            }
            
            .response-content {
                margin-right: 12px;
            }
            
            .response-stats {
                min-width: 65px;
            }
        }
    </style>
</head>
<body>
    <div id="dashboard-content">
        <div class="loading">
            <div>Loading survey data...</div>
        </div>
    </div>

    <script>
        // Configuration - Update these with your Google Sheets details
        const CONFIG = {
            // Replace with your Google Sheets ID
            SHEET_ID: '1V3VpMGqEFC_qEa03om5bgSHQ8yQ0O-VIHAIi_DG0FHw',
            // Replace with your API key
            API_KEY: 'AIzaSyArz5-KtMYQTEt9pxfdRXN3nQ1w39DhvEo',
            // Sheet name (usually 'Sheet1' or 'Form Responses 1')
            SHEET_NAME: 'Sheet1'
        };

        let surveyData = [];

        // Complete sample data with all questions from your original survey
        const SAMPLE_DATA = [
            {
                question: "How are you using AI in your work today?",
                type: "multiple_choice",
                responses: [
                    { text: "Writing emails, captions, or campaign copy", count: 11, percentage: 85 },
                    { text: "Drafting or reviewing creative briefs", count: 10, percentage: 77 },
                    { text: "Analyzing campaign results", count: 6, percentage: 46 },
                    { text: "Discovering or researching creators", count: 5, percentage: 38 },
                    { text: "Generating images or video", count: 2, percentage: 15 },
                    { text: "I'm not using AI at work yet", count: 1, percentage: 8 }
                ],
                total_responses: 13,
                other_responses: "AI tools that speed up creative workflow like rotoscoping, Photoshop generative AI, Scripting, Creative Ideation"
            },
            {
                question: "What's your go-to AI tool?",
                type: "single_choice",
                responses: [
                    { text: "ChatGPT", count: 8, percentage: 62 },
                    { text: "Claude", count: 3, percentage: 23 },
                    { text: "Gemini", count: 3, percentage: 23 },
                    { text: "Other", count: 2, percentage: 15 }
                ],
                total_responses: 13,
                other_responses: "Claude AI, Poppy AI, ElevenLabs, Gamma for presentations"
            }
        ];

        // Function to parse Google Sheets data into survey format
        function parseSheetData(sheetData) {
            if (!sheetData || !sheetData.values || sheetData.values.length < 2) {
                return SAMPLE_DATA; // Return sample data if no real data
            }

            const headers = sheetData.values[0];
            const rows = sheetData.values.slice(1);
            
            // Only process specific columns: H-L (indices 7-11) and R (index 17)
            const targetColumns = [7, 8, 9, 10, 11, 17]; // H, I, J, K, L, R (0-indexed)
            const questions = [];
            
            targetColumns.forEach(index => {
                if (index < headers.length && headers[index] && headers[index].trim()) {
                    const header = headers[index];
                    const responses = {};
                    let totalResponses = 0;
                    let otherResponses = [];
                    
                    rows.forEach(row => {
                        if (row[index] && row[index].trim()) {
                            const answer = row[index].trim();
                            
                            // Handle multiple choice questions (responses separated by commas or semicolons)
                            if (answer.includes(',') || answer.includes(';')) {
                                const multipleAnswers = answer.split(/[,;]/).map(a => a.trim());
                                multipleAnswers.forEach(ans => {
                                    if (ans) {
                                        responses[ans] = (responses[ans] || 0) + 1;
                                        totalResponses++;
                                    }
                                });
                            } else {
                                // Check if it's an "Other" response (usually longer text)
                                if (answer.length > 50 || answer.toLowerCase().includes('other')) {
                                    otherResponses.push(answer);
                                } else {
                                    responses[answer] = (responses[answer] || 0) + 1;
                                    totalResponses++;
                                }
                            }
                        }
                    });
                    
                    // Convert to array and calculate percentages
                    const responseArray = Object.entries(responses)
                        .map(([text, count]) => ({
                            text,
                            count,
                            percentage: totalResponses > 0 ? Math.round((count / totalResponses) * 100) : 0
                        }))
                        .sort((a, b) => b.count - a.count);
                    
                    // Only include questions that have actual responses
                    if (responseArray.length > 0) {
                        // Determine question type
                        let questionType = "single_choice";
                        if (header.toLowerCase().includes('scale') || header.includes('1-5')) {
                            questionType = "scale";
                        } else if (responseArray.length > 5 || header.toLowerCase().includes('select all')) {
                            questionType = "multiple_choice";
                        }
                        
                        const questionData = {
                            question: header,
                            type: questionType,
                            responses: responseArray,
                            total_responses: Math.max(totalResponses, rows.filter(row => row[index] && row[index].trim()).length)
                        };
                        
                        // Add other responses if any
                        if (otherResponses.length > 0) {
                            questionData.other_responses = otherResponses.join('; ');
                        }
                        
                        questions.push(questionData);
                    }
                }
            });
            
            return questions.length > 0 ? questions : SAMPLE_DATA;
        }

        // Function to load data from Google Sheets using public CSV method
        async function loadFromGoogleSheets() {
            try {
                // First try the API method
                const apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SHEET_ID}/values/${CONFIG.SHEET_NAME}?key=${CONFIG.API_KEY}`;
                
                try {
                    const apiResponse = await fetch(apiUrl);
                    if (apiResponse.ok) {
                        const data = await apiResponse.json();
                        return parseSheetData(data);
                    }
                } catch (apiError) {
                    console.log('API method failed, trying alternative method:', apiError);
                }
                
                // Fallback: Try using public CSV export (requires sheet to be public)
                const csvUrl = `https://docs.google.com/spreadsheets/d/${CONFIG.SHEET_ID}/export?format=csv&gid=0`;
                const csvResponse = await fetch(csvUrl);
                
                if (!csvResponse.ok) {
                    throw new Error(`HTTP error! status: ${csvResponse.status}. Make sure your Google Sheet is public (anyone with the link can view).`);
                }
                
                const csvText = await csvResponse.text();
                return parseCSVData(csvText);
                
            } catch (error) {
                console.error('Error loading from Google Sheets:', error);
                throw error;
            }
        }

        // Function to parse CSV data into survey format
        function parseCSVData(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim());
            if (lines.length < 2) {
                return SAMPLE_DATA;
            }

            const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
            const rows = lines.slice(1).map(line => {
                // Simple CSV parsing (handles quoted values)
                const values = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                values.push(current.trim());
                return values;
            });
            
            // Only process specific columns: H-L (indices 7-11) and R (index 17)
            const targetColumns = [7, 8, 9, 10, 11, 17]; // H, I, J, K, L, R (0-indexed)
            const questions = [];
            
            targetColumns.forEach(index => {
                if (index < headers.length && headers[index] && headers[index].trim()) {
                    const header = headers[index];
                    const responses = {};
                    let totalResponses = 0;
                    let otherResponses = [];
                    
                    rows.forEach(row => {
                        if (row[index] && row[index].trim()) {
                            const answer = row[index].replace(/"/g, '').trim();
                            
                            // Handle multiple choice questions (responses separated by commas or semicolons)
                            if (answer.includes(',') || answer.includes(';')) {
                                const multipleAnswers = answer.split(/[,;]/).map(a => a.trim());
                                multipleAnswers.forEach(ans => {
                                    if (ans) {
                                        responses[ans] = (responses[ans] || 0) + 1;
                                        totalResponses++;
                                    }
                                });
                            } else {
                                // Check if it's an "Other" response (usually longer text)
                                if (answer.length > 50 || answer.toLowerCase().includes('other')) {
                                    otherResponses.push(answer);
                                } else {
                                    responses[answer] = (responses[answer] || 0) + 1;
                                    totalResponses++;
                                }
                            }
                        }
                    });
                    
                    // Convert to array and calculate percentages
                    const responseArray = Object.entries(responses)
                        .map(([text, count]) => ({
                            text,
                            count,
                            percentage: totalResponses > 0 ? Math.round((count / totalResponses) * 100) : 0
                        }))
                        .sort((a, b) => b.count - a.count);
                    
                    // Only include questions that have actual responses
                    if (responseArray.length > 0) {
                        // Determine question type
                        let questionType = "single_choice";
                        if (header.toLowerCase().includes('scale') || header.includes('1-5')) {
                            questionType = "scale";
                        } else if (responseArray.length > 5 || header.toLowerCase().includes('select all')) {
                            questionType = "multiple_choice";
                        }
                        
                        const questionData = {
                            question: header,
                            type: questionType,
                            responses: responseArray,
                            total_responses: Math.max(totalResponses, rows.filter(row => row[index] && row[index].trim()).length)
                        };
                        
                        // Add other responses if any
                        if (otherResponses.length > 0) {
                            questionData.other_responses = otherResponses.join('; ');
                        }
                        
                        questions.push(questionData);
                    }
                }
            });
            
            return questions.length > 0 ? questions : SAMPLE_DATA;
        }

        // Function to render the dashboard
        function renderDashboard(data) {
            let html = `
                <div class="container">
                    <div class="content">
            `;

            data.forEach((question, index) => {
                html += `
                    <div class="section">
                        <div class="survey-question">
                            <h2 class="section-title">${question.question}</h2>
                            <div class="response-count">${question.total_responses} responses</div>
                            
                            <div class="responses-container">
                `;

                question.responses.forEach(response => {
                    html += `
                        <div class="response-item">
                            <div class="response-bar">
                                <div class="response-bar-fill" style="width: ${response.percentage}%;"></div>
                            </div>
                            <div class="response-content">
                                <div class="response-text">${response.text}</div>
                            </div>
                            <div class="response-stats">
                                <div class="response-percentage">${response.percentage}%</div>
                                <div class="response-number">${response.count} response${response.count !== 1 ? 's' : ''}</div>
                            </div>
                        </div>
                    `;
                });

                html += `</div>`;

                if (question.other_responses) {
                    html += `
                        <div class="other-responses">
                            <div class="other-title">Other responses:</div>
                            <div class="other-text">${question.other_responses}</div>
                        </div>
                    `;
                }

                html += `</div></div>`;
            });

            html += `
                        <div class="update-time">
                            Last updated: ${new Date().toLocaleString()}
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('dashboard-content').innerHTML = html;

            // Animate the bars with staggered timing
            setTimeout(() => {
                const bars = document.querySelectorAll('.response-bar-fill');
                bars.forEach((bar, index) => {
                    const width = bar.style.width;
                    bar.style.width = '0%';
                    setTimeout(() => {
                        bar.style.width = width;
                    }, 100 + (index * 50)); // Staggered animation
                });
            }, 100);
        }

        // Function to show error
        function showError(message) {
            document.getElementById('dashboard-content').innerHTML = `
                <div class="error">
                    <h3>Error Loading Data</h3>
                    <p>${message}</p>
                    <p><strong>To fix this:</strong></p>
                    <ol style="color: #ff6b6b; margin: 10px 0; padding-left: 20px;">
                        <li>Make your Google Sheet public: Share → "Anyone with the link can view"</li>
                        <li>Or check your API key permissions</li>
                        <li>Refresh the page to try again</li>
                    </ol>
                    <p>Showing sample data for now:</p>
                </div>
            `;
            renderDashboard(SAMPLE_DATA);
        }

        // Main function to load survey data
        async function loadSurveyData() {
            try {
                surveyData = await loadFromGoogleSheets();
                renderDashboard(surveyData);
            } catch (error) {
                showError(error.message);
            }
        }

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadSurveyData();
        });
    </script>
</body>
</html>
